# PA3-1-3 Dance Report

要求维护一个序列，支持插入、交换、平移、翻转操作。

提供两点新的思路：

- 虽然题目中建议使用 Splay，但是作为平衡树中函数式编程的代表 FHQ Treap，非旋二叉树在代码复杂度上有明显的优势，时间复杂度和 Splay 相同（常数会稍微大一点）。其实现原理基本是根据每个节点上权值的随机性保证二叉搜索树的期望树高，通过对平衡树的 split 和 merge 两个核心操作完成插入、删除、翻转等操作。具体的原理可以在我高中的博客 [「算法笔记」FHQ-Treap - Siyuan 的博客](https://blog.siyuanw.cn/archives/FHQ-Treap/)
- 对于平移操作，除了直接使用 split + merge 的方法，也可以打个标记，记录一下当前状态下实际上的第一个人是序列中第几个，而不真的对序列进行平移。然而考虑到平移操作本身的常数也不大，并且打标记录之后会使翻转操作更为复杂，因此代码中并未采用这一 trick。

时间复杂度：$\mathcal O(m \log m)$

空间复杂度：$\mathcal O(n)$

---

困难和参考资料：无（FHQ Treap 的板子搞竞赛的时候用了一两年了，代码或许会和博客里的基本相同，但是真的没有参考而是自己重新敲出来的 qaq）

用时：1h
