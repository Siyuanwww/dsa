# PA1-2 Report

作者：丁思源 2022012901

给定 $n$ 条直线，第 $i$ 条直线经过点 $(0, i)$ 和 $(a_i, 0)$（即横纵截距，且 $a_i$ 是一个排列，隐含了各不相同的条件），求出这些直线在第一、二、四象限的交点个数。

我们将三个象限的答案分成 2 个 Subtasks。

对于第一象限，第 $i, j$ 条直线相交当且仅当 $i < j, a_i > a_j$，这本质上是一个**二维偏序问题**，可以直接使用树状数组解决。

对于第二、四象限，两个象限分别是关于 $(i, a_i)$ 和 $(a_i, i)$ 二元组的两个问题，由于 $a_i$ 是一个排列，下面只考虑第二象限，第四象限同理。直线 $i, j$ 相交当且仅当 $i < j, \dfrac{i}{a_i} > \dfrac{j}{a_j}$。令 $k_i = \dfrac{i}{a_i}$，那么又归约成了 $(i, k_i)$ 的二维偏序问题。不过在具体的代码实现过程中，需要注意两点：

1. 对第二维排序比较时尽量不要使用 `double` 的浮点比较，可以将斜率方程移项成整数的比较。
2. 用树状数组求第一维偏序的过程中，要额外注意第二维不能取等号。

对于树状数组的原理：树状数组中每个节点 $x$ 的值是元素 $a_i, i \in (x - \text{lowbit}(x), x]$ 的和，其中 $\text{lowbit}(x)$ 表示 $(x)_2$ 最低的 $1$ 的位权，即：
$$
\min \{ 2^k \mid x\ 的二进制表达下第\ k\ 位是\ 1\}
$$

那么每次修改元素 $a_x$ 的值，需要修改
$$
\begin{aligned}
& x_0 = x \\
& x_1 = x_0 + \text{lowbit}(x_0) \\
& x_2 = x_1 + \text{lowbit}(x_1) \\
& \cdots \\
& x_m = x_{m - 1} + \text{lowbit}(x_{m - 1}), x_m \le n
\end{aligned}
$$

每次查询 $1 \sim x$ 的前缀和，只需要求
$$
\begin{aligned}
& x_0 = x \\
& x_1 = x_0 - \text{lowbit}(x_0) \\
& x_2 = x_1 - \text{lowbit}(x_1) \\
& \cdots \\
& x_m = x_{m - 1} - \text{lowbit}(x_{m - 1}), x_m > 0
\end{aligned}
$$
的总和。

很容易发现，查询和修改的复杂度都是 $\mathcal O(\log n)$。（篇幅所限，树状数组的直观树形结构此处略去不谈。）

在代码实现过程中，我们可以利用**补码**的性质，得到 $\text{lowbit}(x) = x\ \&\ (-x)$，其中 $\&$ 表示按位与。

时间复杂度：$\mathcal O(n \log n)$

空间复杂度：$\mathcal O(n)$

---

困难和参考资料：无

用时：0.5h
